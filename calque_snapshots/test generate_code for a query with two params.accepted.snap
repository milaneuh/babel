---
version: 1.3.1
title: test generate_code for a query with two params
---
GIVEN a TypedQuery with two parameters:

  %Babel.Query.TypedQuery{
  file: "queries/with_params.sql",
  starting_line: 10,
  name: %Babel.ValueIdentifier{name: "find_user"},
  comment: ["-- Find a user by id and status"],
  content: "SELECT * FROM users WHERE id = $1 AND status = $2",
  params: [:int, :string],
  returns: [
    %Babel.Field{label: "id", type: :int},
    %Babel.Field{label: "name", type: :string},
    %Babel.Field{label: "status", type: :string}
  ]
}

WHEN generating Elixir code with:

  code = Babel.Query.generate_code(query)

THEN the generated Elixir code should be:

defmodule FindUserRow do
  @enforce_keys [:id, :name, :status]
  defstruct [:id, :name, :status]

  @type t :: %__MODULE__{
    id: integer(),
    name: String.t(),
    status: String.t()
  }
end

@doc """
Runs the find_user query defined in queries/with_params.sql.

 Find a user by id and status
"""
@spec find_user(arg_1 :: integer(), arg_2 :: String.t()) :: FindUserRow.t()
def find_user(arg_1, arg_2) when is_integer(arg_1) and is_binary(arg_2) do
  query = "SELECT * FROM users WHERE id = $1 AND status = $2"
  params = [arg_1, arg_2]

  # execution TBD
end
def find_user(arg_1, arg_2) do
  expected = "arg_1 :: integer(), arg_2 :: String.t()"
  received = inspect([arg_1, arg_2])

  raise ArgumentError, """
  Invalid arguments for find_user/2.

  Expected:
    arg_1 :: integer(), arg_2 :: String.t()

  Received:
    #{received}
  """
end


